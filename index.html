<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title></title>
  <script type="text/javascript" src="js/close-pixelate.js"></script>
  <link rel="stylesheet" type="text/css" href="js/pixelate.min.css">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.5/dat.gui.min.js"></script>
  <script src="js/jquery.min.js"></script>
  <script type="text/javascript" src="js/pixelate.min.js"></script>
  <script type="text/javascript" src="js/chroma.min.js"></script>
  <script src="js/jQueryEmoji.min.js"></script>
  <script type="text/javascript" src="js/color.js"></script>
  <script type="text/javascript" src="js/emoji.js"></script>
  <script type="text/javascript" src="js/emojione.js"></script>
  <script type="text/javascript" src="js/emojiController.js"></script>
  <script type="text/javascript" src="js/imageController.js"></script>
</head>

<body>
  <!-- <img id="portrait-image" src="img/portrait.jpg" /> -->
  <img id="portrait-image" src="img/large.png" />
  <button id="pixelate">Pixelate Emojis</button>
  <p id="placeholder" style="letterSpacing:14px"></p>
  <!-- <button id="btndownload">Download</button> -->
  <!-- <a id="download" download onclick="download_img()">Download to myImage.png</a> -->
  <!-- <img id="sprite" src="img/emojis.png" /> -->
  <canvas id="sprite_canvas" width=1008 height="1008"></canvas>
  <!-- <img src="img/emojis.png" /> -->
  <canvas id="emojis" width=1680 height="1680"></canvas>
  <p id="all"></p>
</body>
<style type="text/css">
#emojis {
  display: none;
}

p {
  line-height: 22px;
}
</style>
<script type="text/javascript">
function initSprite() {
  let p = document.getElementById("all")
  let canvas = document.getElementById('sprite_canvas');
  emojiController.toText(p)
  emojiController.toCanvas('#all', canvas);

}

function init() {
  initSprite()

  let img = document.getElementById("portrait-image");

  imageController.setImg(img, 17)

  // Init GUI
  var gui = new dat.GUI();
  gui.add(imageController, 'col', 1, 48).step(1).onChange(newColumn => {

    imageController.toPixel(newColumn);

  }).onFinishChange(newColumn => {

    // let canvas = document.getElementById('sprite_canvas');
    let placeholder = document.getElementById("placeholder");

    let pixels = imageController.getPixelArray();
    let emojiIndex = imageController.updateEmoji(emojiController, placeholder);

  });

  imageController.toPixel();

}




document.getElementById("pixelate").onclick = () => {

  let canvas = document.getElementById('sprite_canvas');
  let placeholder = document.getElementById("placeholder");

  // After all image is loaded
  emojiController.toPixelArray(canvas);
  emojiController.toPixel(canvas)


  let pixels = imageController.getPixelArray();
  let emojiIndex = imageController.updateEmoji(emojiController, placeholder);

  // pixels.map((e,i)=>{
  //   console.log(`"${e.css()}",${emojiIndex[i]},"${emojiController.list[emojiIndex[i]]}"`)
  // })

}


window.addEventListener('load', init, false);
</script>

</html>